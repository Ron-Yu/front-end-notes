<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一個奶爸的部落格，分享前端技術的觀點及生活的點滴。"><meta property="og:title" content="前端奶爸"><meta property="og:image" content="https://avatars0.githubusercontent.com/u/5327305?v=4&amp;u=b43b3248877581a352fbd6667c608695bfaefe69&amp;s=400"><meta property="og:description" content="一個奶爸的部落格，分享前端技術的觀點及生活的點滴。"><title>Event binding and event delegation | 前端奶爸</title><link rel="stylesheet" type="text/css" href="/front-end-notes//css/normalize.css"><link rel="stylesheet" type="text/css" href="/front-end-notes//css/highlight.css"><link rel="stylesheet" type="text/css" href="/front-end-notes//css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/front-end-notes/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/front-end-notes/." class="title">前端奶爸</a><span class="subtitle">Change before you have to.</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/front-end-notes/" class="sidebar-nav-item">Home</a><a href="/front-end-notes/archives" class="sidebar-nav-item">Archives</a><a href="/front-end-notes/about" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Event binding and event delegation</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2017-02-04</div></div></div><article><div class="container post"><blockquote>
<h4 id="到了，叫我。"><a href="#到了，叫我。" class="headerlink" title="到了，叫我。"></a>到了，叫我。</h4></blockquote>
<p>瀏覽器的事件處理很像我們日常生活中會發生的事，針對某些目標，一旦有情況發生，就執行相對應的程序。<br>就像買票去墾丁，我們(對象目標)一旦到達墾丁(情況發生)，我們就會下車(執行程序)。</p>
<h3 id="Event-Binding"><a href="#Event-Binding" class="headerlink" title="Event Binding"></a>Event Binding</h3><p>針對瀏覽器，使用者觸發的行為( 例如 mousemove 或 click ) 或是系統自行觸發的行為 ( 例如 load )，我們稱這些行為為<strong>事件(event)</strong>，並且可以對這些事件註冊<strong>事件處理器(event handler)</strong>，當監聽的事件一旦發生，就執行對應的 event handler。</p>
<ul>
<li>event 其實是物件，有各種 property 及 method 可以使用</li>
<li>event handler 就是 function，即我們要執行的程式碼</li>
</ul>
<p>以下我們來分別使用 javascript 及 jQuery 寫出一個範例，當使用者在螢幕按下滑鼠時，會在瀏覽器發開者工具的頁面看見輸出 <code>hello world</code> ，以下為分別的角色:</p>
<ul>
<li>window: 目標</li>
<li>click: 監聽的事件</li>
<li>sayHello: 事件處理器</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// javascript</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hello world'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'click'</span>, sayHello);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// jQuery</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hello world'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="built_in">window</span>).on(<span class="string">'click'</span>, sayHello);</div></pre></td></tr></table></figure>
<p>將此觀念擴展並實作後，我們可以指定目標，針對目標設定需要監聽事件，並為這些事件註冊事件處理器。一旦目標所監聽的事件發生，就執行事件處理器。</p>
<h3 id="Event-Capturing-and-Bubbling"><a href="#Event-Capturing-and-Bubbling" class="headerlink" title="Event Capturing and Bubbling"></a>Event Capturing and Bubbling</h3><p>在談論 <strong>event delegation</strong> 之前，我們先來了解事件( event )是如何在 DOM tree 傳遞。<br>以下面的 dom 為例子，當我們用滑鼠按了 <code>click me</code> 的按鈕，<strong>click</strong> 事件便開始在 dom 之間傳遞，直到事件完成 1 個 cycle，結束事件的傳遞。<br>事實上，事件的傳遞可分為 3 個部分:  </p>
<ul>
<li><strong>capturing</strong>: 由外圍開始向 target 傳遞事件，在這個例子即為<ul>
<li>wrapper1 =&gt; wrapper2 =&gt; wrapper3 =&gt; target</li>
</ul>
</li>
<li><strong>target</strong>: 驅動這個事件的目標，在這個例子即為 <code>&lt;button class=&quot;target&quot;&gt;click me&lt;/button&gt;</code></li>
<li><strong>bubbling</strong>: 由target開始向外圍傳遞事件，在這個例子即為<ul>
<li>target =&gt; wrapper3 =&gt; wrapper2 =&gt;  wrapper1</li>
</ul>
</li>
</ul>
<p>整體來看的概念如以下所示:</p>
<ul>
<li>capturing + target + bubbling</li>
<li>wrapper1 =&gt; wrapper2 =&gt; wrapper3 =&gt; target =&gt; wrapper3 =&gt; wrapper2 =&gt;  wrapper1</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">--</span> <span class="attr">html</span> 結構 <span class="attr">--</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper2"</span>&gt;</span>                      </div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper3"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"target"</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>javascript 預設的事件處理為 <strong>event bubbling</strong>，原因在此不贅述，簡單的說，事件的傳遞在 capturing 階段不執行任何的 event handler，直到事件傳遞到 target 及 bubbling 階段，才針對監聽的事件，執行 event handler。  </p>
<p>根據以下的程式碼範例，我們可以看見事件傳遞階段會依序發生的事:</p>
<ul>
<li><strong>capturing 階段</strong><ul>
<li>wrapper1: 未執行 event hanlder</li>
<li>wrapper2: 未執行 event hanlder</li>
<li>wrapper3: 未執行 event hanlder</li>
</ul>
</li>
<li><strong>target 階段</strong><ul>
<li>target: ‘this is target’</li>
</ul>
</li>
<li><strong>bubbling 階段</strong><ul>
<li>wrapper3: ‘this is wrapper3’</li>
<li>wrapper2: ‘this is wrapper2’</li>
<li>wrapper1: ‘this is wrapper1’</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// javascript</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> wrapper1Node = <span class="built_in">document</span>.getElementById(<span class="string">'wrapper1'</span>);</div><div class="line"><span class="keyword">var</span> wrapper2Node = <span class="built_in">document</span>.getElementById(<span class="string">'wrapper2'</span>);</div><div class="line"><span class="keyword">var</span> wrapper3Node = <span class="built_in">document</span>.getElementById(<span class="string">'wrapper3'</span>);</div><div class="line"><span class="keyword">var</span> targetNode = <span class="built_in">document</span>.getElementById(<span class="string">'target'</span>);</div><div class="line"></div><div class="line">wrapper1Node.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper1'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">wrapper2Node.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper2'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">wrapper3Node.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper3'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">targetNode.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is target'</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//jQuery</span></div><div class="line"></div><div class="line">$(<span class="string">'#wrapper1'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper1'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$(<span class="string">'#wrapper2'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper2'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$(<span class="string">'#wrapper3'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is wrapper3'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$(<span class="string">'#target'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is target'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Event-Delegation"><a href="#Event-Delegation" class="headerlink" title="Event Delegation"></a>Event Delegation</h3><p>Event Delegation 即事件代理，在討論實作之前，我們先針對以下的需求，寫出相對應的程式碼。</p>
<p>需求: 當使用按了 <code>list</code> 元素，在 browser dev tool 輸出 <code>list</code> 中的文字</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"bookList"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"bookListItem"</span>&gt;</span>book 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"bookListItem"</span>&gt;</span>book 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"bookListItem"</span>&gt;</span>book 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"bookListItem"</span>&gt;</span>book 4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"bookListItem"</span>&gt;</span>book 5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// javascript</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> listNodes = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.bookListItem'</span>);</div><div class="line">listNodes = <span class="built_in">Array</span>.from(listNodes); <span class="comment">// convert to array</span></div><div class="line"></div><div class="line">listNodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">listNode</span>) </span>&#123;</div><div class="line">    listNode.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(e.target.innerHTML);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// jQuery</span></div><div class="line"></div><div class="line">$(<span class="string">'.bookListItem'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log($(<span class="keyword">this</span>).html());</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>由上述的程式碼，我們可以看出針對每個 <code>list</code> node 設定監聽 click 的事件，當事件發生時，會執行 event hanlder 的內容，即在 browser dev tool 輸出 <code>list</code> 中的文字。  </p>
<p>但是在某些常見的情況，上述的解法會有效能問題或無法實作的情況:</p>
<ul>
<li><code>list</code> node 有很多時，例如有 50 個，我們必須對這 50 個 <code>list</code> node 分別進行 event binding，相當於同時監聽 50 個 node，造成質性效能不佳。</li>
<li>動態產生的 <code>list</code> node 沒有被加入到當初的 event binding，相當於不符合之前的需求。</li>
</ul>
<p>上述的情況可以由 <strong>evnet delegation</strong> 幫我們解決，由於 event 具有 bubbling 的特性，因此針對槽狀的 html 結構，並不需要一一為內部 dom node 綁定事件，而是可以只需在外圍的 dom node 綁定事件，一旦事件觸發時，直到事件 bubble 至外圍的 dom node時，才執行 event hanlder。<br>以下為改善之前的例子而使用 event delegatin 的程式碼。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// javascript</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> bookListNode = <span class="built_in">document</span>.querySelector(<span class="string">'#bookList'</span>);</div><div class="line"></div><div class="line">bookListNode.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(e.target &amp;&amp; e.target.className === <span class="string">'bookListItem'</span>) &#123;</div><div class="line">        <span class="built_in">console</span>.log(e.target.innerHTML);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// jQuery</span></div><div class="line"></div><div class="line">$(<span class="string">'#bookList'</span>).on(<span class="string">'click'</span>, <span class="string">'.bookListItem'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log($(<span class="keyword">this</span>).html());</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'ronyu';
var disqus_identifier = '2017/02/04/my-first-post/';
var disqus_title = 'Event binding and event delegation';
var disqus_url = 'https://ron-yu.github.io/front-end-notes/2017/02/04/my-first-post/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:ronyu77@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/Ron-Yu" target="_blank"><i class="fa fa-github"></i></a></div><div class="footer">© 2017 <a href="/front-end-notes/" rel="nofollow">前端奶爸</a></div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>